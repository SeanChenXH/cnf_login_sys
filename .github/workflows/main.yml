# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: checkout all the submodules
        uses: actions/checkout@v2
        with:
          submodules: recursive

      - name: Build with Maven
        run: |
          pwd
          ls
          cd cnf_common/
          pwd
          ls
          mvn install
          cd ..
          pwd
          ls
          cd cnf_login/
          mvn clean package
          pwd
          ls -al
          cd target/
      - name: copy file via ssh password
        uses: appleboy/scp-action@master
        with:
          host: "198.199.84.209"
          username: "chen1chen2"
          password: "Wh3r3Ar3AllTh3Ch3ns"
          port: "22"
          source: "cnf_login/target/cnf_login-0.0.1-SNAPSHOT.jar"
          target: "server"
      - name: ls -a via ssh
        uses: fifsky/ssh-action@master
        with:
          command: |
            sudo -S <<< "Wh3r3Ar3AllTh3Ch3ns" systemctl stop start-springboot.service
            sudo -S <<< "Wh3r3Ar3AllTh3Ch3ns" systemctl start start-springboot.service
          host: "198.199.84.209"
          user: "chen1chen2"
          pass: "Wh3r3Ar3AllTh3Ch3ns"

## A workflow run is made up of one or more jobs that can run sequentially or in parallel
#jobs:
#  # This workflow contains a single job called "build"
#  build:
#    # The type of runner that the job will run on
#    runs-on: ubuntu-latest
#
#    # Steps represent a sequence of tasks that will be executed as part of the job
#    steps:
#      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
#      - uses: actions/checkout@v3
#
#      # Runs a single command using the runners shell
#      - name: Run a one-line script
#        run: echo Hello, world!
#
#      # Runs a set of commands using the runners shell
#      - name: Run a multi-line script
#        run: |
#          echo Add other actions to build,
#          echo test, and deploy your project.
#
#      - name: Set up JDK 11
#          uses: actions/setup-java@v3
#          with:
#            java-version: '11'
#            distribution: 'adopt'
#            - name: Build with Maven
#              run: |
#                pwd
#                ls
#                cd cnf_login
#                mvn clean package
#                pwd
#                ls -al